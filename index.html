<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Astrojigs • Portfolio</title>

  <!-- Favicons -->
  <link rel="icon" href="/assets/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">

  <!-- Match Streamlit background (change if you use a custom theme) -->
  <meta name="theme-color" content="#f4f3ed">

  <style>
    :root { --bg: #f4f3ed; } /* change if your Streamlit bg differs */
    html, body { height: 100%; margin: 0; background: var(--bg); }
    body { overflow: hidden; }

    /* Full-viewport app iframe (scoped so we don't style BMC popup iframe) */
    .app-frame {
      position: fixed; inset: 0;
      width: 100%; height: 100%;
      border: 0; background: var(--bg);
      display: block;
      z-index: 1;
    }

    /* Mask bar to hide Streamlit badge at the bottom */
    .mask-bottom {
      position: fixed; left: 0; right: 0; bottom: 0;
      height: calc(48px + env(safe-area-inset-bottom, 0px)); /* tweak 40–56px if needed */
      background: var(--bg);
      z-index: 2;
      pointer-events: none; /* don't block clicks on your app */
    }

    /* Stacking: keep the BMC button ABOVE the popup so a second click toggles it closed */
    #bmc-wbtn { z-index: 2147483647 !important; pointer-events: auto !important; }
    iframe[title="Buy Me a Coffee"] { z-index: 2147483646 !important; }
  </style>
</head>
<body>
  <!-- `?embed=true` hides Streamlit footer & padding in embeds -->
  <iframe
    class="app-frame"
    title="Astrojigs Portfolio"
    src="https://astrojigs.streamlit.app/?embed=true"
    allow="clipboard-read; clipboard-write; fullscreen; geolocation"
    allowfullscreen
    loading="eager">
  </iframe>

  <!-- Mask bar to cover the bottom-right "Built with Streamlit" badge -->
  <div class="mask-bottom" aria-hidden="true"></div>

  <!-- Buy Me a Coffee widget -->
  <script data-name="BMC-Widget" data-cfasync="false"
          src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
          data-id="astrojigs2a"
          data-description="Support me on Buy me a coffee!"
          data-message="Thank you for visiting! You can buy me a coffee. ☕"
          data-color="#FF813F"
          data-position="Right"
          data-x_margin="18"
          data-y_margin="18"></script>

  <!-- Make the BMC button toggle the popup reliably -->
  <script>
    (function () {
      let reinjecting = false;

      function popupIframes() {
        return Array.from(document.querySelectorAll('iframe[title="Buy Me a Coffee"]'));
      }

      function isPopupVisible() {
        for (const el of popupIframes()) {
          const cs = getComputedStyle(el);
          if (cs.display === 'none' || cs.visibility === 'hidden') continue;
          const r = el.getBoundingClientRect();
          if (r.width > 20 && r.height > 20) return true;
        }
        return false;
      }

      function hidePopup() {
        popupIframes().forEach(el => { el.style.display = 'none'; });
        document.body.style.overflow = ''; // just in case the widget locked scroll
      }

      function reinjectWidgetIfNeeded() {
        if (reinjecting) return;
        // If the widget didn't open within the window, reinject it.
        setTimeout(() => {
          if (isPopupVisible()) return; // it opened fine
          reinjecting = true;

          // Remove old button (if any) and hidden popups
          const btn = document.getElementById('bmc-wbtn');
          if (btn) btn.remove();
          popupIframes().forEach(el => el.remove());

          // Clone attributes from the existing script (for your ID/message/color/etc.)
          const old = document.querySelector('script[data-name="BMC-Widget"]');
          const s = document.createElement('script');
          s.setAttribute('data-name', 'BMC-Widget');
          s.setAttribute('data-cfasync', 'false');
          s.src = 'https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js';

          if (old) {
            for (const attr of old.attributes) {
              if (attr.name.startsWith('data-') && attr.name !== 'data-name' && attr.name !== 'src') {
                s.setAttribute(attr.name, attr.value);
              }
            }
          } else {
            // Fallback defaults (shouldn't be needed)
            s.setAttribute('data-id', 'astrojigs2a');
            s.setAttribute('data-position', 'Right');
            s.setAttribute('data-color', '#FF813F');
            s.setAttribute('data-x_margin', '18');
            s.setAttribute('data-y_margin', '18');
          }

          s.onload = () => {
            reinjecting = false;
            // Re-bind click handler after the new button appears
            enhanceBmcToggle();
          };

          document.body.appendChild(s);
        }, 600); // give the widget ~0.6s to open normally
      }

      function enhanceBmcToggle() {
        const btn = document.getElementById('bmc-wbtn');
        if (!btn) { setTimeout(enhanceBmcToggle, 250); return; }

        // Avoid stacking multiple handlers
        if (btn._bmcToggleBound) return;
        btn._bmcToggleBound = true;

        // Capture-phase so we run before the widget's own click handler
        btn.addEventListener('click', function (e) {
          if (isPopupVisible()) {
            // Close: prevent the widget's "open" action and hide instead
            e.preventDefault();
            e.stopImmediatePropagation();
            hidePopup();
          } else {
            // Open: let the widget handle it; then verify it actually opened
            reinjectWidgetIfNeeded();
          }
        }, true);
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', enhanceBmcToggle);
      } else {
        enhanceBmcToggle();
      }
    })();
  </script>
</body>
</html>
